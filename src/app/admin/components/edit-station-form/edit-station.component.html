<div class="edit-container">
    <div class="map-container">
        <app-map
            [latitude]="stationForm.get(fields.LATITUDE)?.value"
            [longitude]="stationForm.get(fields.LONGITUDE)?.value"
            [city]="stationForm.get(fields.CITY)?.value"
            [connectedTo]="connectedTo.value"
        >
        </app-map>
    </div>
    <div class="form-container">
        <form [formGroup]="stationForm">
            <div class="form-group mb-2">
                <label for="city" class="block text-900 text-xl font-medium mb-2">{{
                    'STATION_PAGE.FIELDS.CITY_NAME.NAME' | translate
                }}</label>
                <input
                    [id]="fields.CITY"
                    [formControlName]="fields.CITY"
                    placeholder="{{ 'STATION_PAGE.FIELDS.CITY_NAME.PLACEHOLDER' | translate }}"
                    type="text"
                    pInputText
                />

                @if (stationForm.get(fields.CITY); as rows) {
                    @if (!rows.pristine) {
                        @for (error of handleCityNameErrorMessages(rows.errors); track $index) {
                            <small class="p-error block mt-2"> {{ error | translate }} </small>
                        }
                    }
                }
            </div>

            <div class="form-group mb-2">
                <label for="latitude" class="block text-900 text-xl font-medium mb-2">
                    {{ 'STATION_PAGE.FIELDS.LATITUDE.NAME' | translate }}
                </label>
                <input id="latitude" type="number" formControlName="latitude" pInputText />

                @if (stationForm.get(fields.LATITUDE); as rows) {
                    @if (!rows.pristine) {
                        @for (error of handleLatitudeErrorMessages(rows.errors); track $index) {
                            <small class="p-error block mt-2"> {{ error | translate }} </small>
                        }
                    }
                }
            </div>

            <div class="form-group mb-2">
                <label for="longitude" class="block text-900 text-xl font-medium mb-2">
                    {{ 'STATION_PAGE.FIELDS.LONGITUDE.NAME' | translate }}</label
                >
                <input id="longitude" type="number" formControlName="longitude" pInputText />

                @if (stationForm.get(fields.LONGITUDE); as rows) {
                    @if (!rows.pristine) {
                        @for (error of handleLongitudeErrorMessages(rows.errors); track $index) {
                            <small class="p-error block mt-2"> {{ error | translate }} </small>
                        }
                    }
                }
            </div>

            <div class="form-group mb-5">
                <div class="text-900 text-xl font-medium mb-2">
                    <label for="connectedTo">
                        {{ 'STATION_PAGE.FIELDS.CONNECTED.NAME' | translate }}
                    </label>

                    <p-button
                        severity="success"
                        (click)="addConnectedTo()"
                        icon="pi pi-plus"
                        [rounded]="true"
                        [text]="true"
                        [raised]="true"
                    />
                </div>

                <div formArrayName="connectedTo">
                    <div
                        *ngFor="let control of connectedTo.controls; let i = index"
                        [formGroupName]="i"
                        class="flex align-items-center mb-2 gap-2"
                    >
                        <p-dropdown
                            formControlName="city"
                            optionLabel="city"
                            optionValue="city"
                            [options]="stations"
                            placeholder="Select a City"
                            class="w-full"
                            styleClass="w-full"
                        />

                        <p-button
                            severity="danger"
                            (click)="removeConnectedTo(i)"
                            icon="pi pi-trash"
                            [rounded]="true"
                            [text]="true"
                            [raised]="true"
                        ></p-button>
                    </div>
                </div>
            </div>

            <div class="flex gap-2">
                <p-button
                    type="submit"
                    (click)="onSaveStation()"
                    [disabled]="stationForm.invalid"
                    label="{{ 'BUTTONS.SAVE' | translate }}"
                    severity="primary"
                />
                <p-button (click)="onCancelEdit()" label="{{ 'BUTTONS.CANCEL' | translate }}" severity="secondary" />
            </div>
        </form>
    </div>
</div>
