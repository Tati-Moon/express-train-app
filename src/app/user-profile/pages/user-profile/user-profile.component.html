<div class="surface-ground flex align-items-center justify-content-center min-h-screen overflow-hidden">
    <div class="flex flex-column align-items-center justify-content-center w-full" style="max-width: 800px">
        <div
            style="
                border-radius: 56px;
                padding: 0.3rem;
                background: linear-gradient(180deg, var(--primary-color) 10%, rgba(33, 150, 243, 0) 30%);
            "
            class="w-full"
        >
            <div class="w-full surface-card py-8 px-5 sm:px-8" style="border-radius: 53px">
                <div class="text-center">
                    <div class="text-900 text-4xl font-medium">{{ 'PROFILE_PAGE.TITLE' | translate }}</div>
                </div>

                <!-- Profile Form -->
                <div [formGroup]="userForm">
                    <div class="flex justify-content-end align-items-center mb-5">
                        @if (userForm.controls['role'].value !== 'User') {
                            <span class="text-900 text-2xl font-medium">{{ userForm.controls['role'].value }}</span>
                        }
                    </div>
                    <div class="flex justify-content-end align-items-center mb-5">
                        <p-button
                            label="{{ 'PROFILE_PAGE.CHANGE_PASSWORD' | translate }}"
                            (click)="openPasswordModal()"
                        ></p-button>
                    </div>
                    <div class="form-group">
                        <label for="name" class="block text-900 text-xl font-medium mb-2">{{
                            'PROFILE_PAGE.NAME' | translate
                        }}</label>
                        @if (isEditingName) {
                            <div class="flex justify-content-between align-items-center mb-2">
                                <input
                                    id="name"
                                    type="text"
                                    formControlName="name"
                                    pInputText
                                    class="flex-grow-1 mr-2"
                                    [ngClass]="{
                                        'p-invalid':
                                            !userForm.controls['name'].valid && userForm.controls['name'].touched,
                                    }"
                                    placeholder="{{ 'PROFILE_PAGE.NAME_PLACEHOLDER' | translate }}"
                                />
                                <p-button
                                    icon="pi pi-save"
                                    (click)="saveUserName()"
                                    [disabled]="!userForm.controls['name'].valid"
                                    styleClass="ml-2"
                                ></p-button>
                            </div>
                        } @else {
                            <div class="flex justify-content-between align-items-center mb-2">
                                <span>{{ userForm.controls['name'].value }}</span>
                                <p-button
                                    (click)="toggleEditName()"
                                    icon="pi pi-pencil"
                                    [rounded]="true"
                                    [text]="true"
                                />
                            </div>
                        }

                        @if (!userForm.controls['name'].valid && userForm.controls['name'].touched) {
                            @if (userForm.controls['name'].hasError('required')) {
                                <small class="p-error block mt-2">
                                    {{ 'PROFILE_PAGE.NAME_REQUIRED' | translate }}
                                </small>
                            } @else if (userForm.controls['name'].hasError('minlength')) {
                                <small class="p-error block mt-2">
                                    {{ 'PROFILE_PAGE.NAME_MINLENGTH' | translate }}
                                </small>
                            } @else if (userForm.controls['name'].hasError('maxlength')) {
                                <small class="p-error block mt-2">
                                    {{ 'PROFILE_PAGE.NAME_MAXLENGTH' | translate }}
                                </small>
                            } @else {
                                <small class="p-error block mt-2">
                                    {{ 'PROFILE_PAGE.NAME_COMMON_ERROR_MESSAGE' | translate }}
                                </small>
                            }
                        }
                    </div>

                    <div class="form-group mb-5">
                        <label for="email" class="block text-900 text-xl font-medium mb-2">{{
                            'PROFILE_PAGE.EMAIL' | translate
                        }}</label>
                        @if (isEditingEmail) {
                            <div class="flex justify-content-between align-items-center mb-2">
                                <input
                                    id="email"
                                    type="email"
                                    formControlName="email"
                                    pInputText
                                    class="flex-grow-1 mr-2"
                                    [ngClass]="{
                                        'p-invalid':
                                            !userForm.controls['email'].valid && userForm.controls['email'].touched,
                                    }"
                                    placeholder="{{ 'PROFILE_PAGE.EMAIL_PLACEHOLDER' | translate }}"
                                />
                                <p-button
                                    icon="pi pi-save"
                                    (click)="saveUserEmail()"
                                    [disabled]="!userForm.controls['email'].valid"
                                    styleClass="ml-2"
                                ></p-button>
                            </div>
                        } @else {
                            <div class="flex justify-content-between align-items-center mb-2">
                                <span>{{ userForm.controls['email'].value }}</span>
                                <p-button
                                    (click)="toggleEditEmail()"
                                    icon="pi pi-pencil"
                                    [rounded]="true"
                                    [text]="true"
                                />
                            </div>
                        }

                        @if (!userForm.controls['email'].valid && userForm.controls['email'].touched) {
                            @if (userForm.controls['email'].hasError('required')) {
                                <small class="p-error block mt-2">
                                    {{ 'PROFILE_PAGE.EMAIL_REQUIRED' | translate }}
                                </small>
                            } @else if (userForm.controls['email'].hasError('email')) {
                                <small class="p-error block mt-2">
                                    {{ 'PROFILE_PAGE.EMAIL_INVALID' | translate }}
                                </small>
                            } @else {
                                <small class="p-error block mt-2">
                                    {{ 'PROFILE_PAGE.EMAIL_COMMON_ERROR_MESSAGE' | translate }}
                                </small>
                            }
                        }
                    </div>

                    <div class="flex gap-2">
                        <p-button
                            icon="pi pi-sign-out"
                            label="{{ 'PROFILE_PAGE.LOGOUT' | translate }}"
                            (click)="logout()"
                            severity="warning"
                        ></p-button>
                    </div>
                </div>

                <!-- Password Change Modal -->
                <p-dialog
                    [(visible)]="isPasswordModalOpen"
                    header="{{ 'PROFILE_PAGE.CHANGE_PASSWORD' | translate }}"
                    [modal]="true"
                    [closable]="true"
                >
                    <div [formGroup]="passwordForm">
                        <div class="mb-3">
                            <label for="name" class="block text-900 text-xl font-medium mb-2">{{
                                'PROFILE_PAGE.NEWPASSWORD' | translate
                            }}</label>
                            <input
                                type="password"
                                formControlName="newPassword"
                                pInputText
                                class="w-full mb-2"
                                [ngClass]="{
                                    'p-invalid':
                                        !passwordForm.controls['newPassword'].valid &&
                                        passwordForm.controls['newPassword'].touched,
                                }"
                                placeholder="{{ 'PROFILE_PAGE.NEW_PASSWORD_PLACEHOLDER' | translate }}"
                            />
                            @if (
                                !passwordForm.controls['newPassword'].valid &&
                                passwordForm.controls['newPassword'].touched
                            ) {
                                @if (passwordForm.controls['newPassword'].hasError('required')) {
                                    <small class="p-error block mt-2">
                                        {{ 'PROFILE_PAGE.PASSWORD_REQUIRED' | translate }}
                                    </small>
                                } @else if (passwordForm.controls['newPassword'].hasError('strong')) {
                                    <small class="p-error block mt-2">
                                        {{ 'PROFILE_PAGE.PASSWORD_STRONG' | translate }}
                                    </small>
                                } @else {
                                    <small class="p-error block mt-2">
                                        {{ 'PROFILE_PAGE.PASSWORD_COMMON_ERROR_MESSAGE' | translate }}
                                    </small>
                                }
                                <small class="p-error block mt-2">
                                    <ul>
                                        <li>{{ 'PROFILE_PAGE.PASSWORD_MINLENGTH' | translate }}</li>
                                        <li>{{ 'PROFILE_PAGE.PASSWORD_LOWER' | translate }}</li>
                                        <li>{{ 'PROFILE_PAGE.PASSWORD_UPPER' | translate }}</li>
                                        <li>{{ 'PROFILE_PAGE.PASSWORD_NUMBER' | translate }}</li>
                                        <li>{{ 'PROFILE_PAGE.PASSWORD_SPECIAL' | translate }}</li>
                                    </ul>
                                </small>
                            }
                        </div>
                        <p-button
                            label="{{ 'PROFILE_PAGE.SAVE' | translate }}"
                            (click)="changePassword()"
                            [disabled]="!passwordForm.valid"
                            styleClass="w-full"
                        ></p-button>
                    </div>
                </p-dialog>
            </div>
        </div>
    </div>
</div>
